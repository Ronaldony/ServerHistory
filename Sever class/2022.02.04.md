# 2022/02/04 수업내용
## 네트워크
### TCP 헤더
1. 3 Way Handshaking 연결(aka connect 함수)
    1) SYN(**클라**, 연결 요청, SYN-SENT): SYN를 1로 세우고 클라 시퀀스 번호를 난수로 지정하여 서버에 TCP 헤더 20byte 전송
    2) SYN/ACK(**서버**, 응답 및 연결, SYN-RECEIVED): SYN를 1로 세우고 클라의 시퀀스 번호에 +1 값을 ACK에 저장 후 서버 시퀀스 번호를 난수로 지정하여 서버에 TCP 헤더 20byte 전송
    3) ACK(**클라**, 응답, ESTABLESHED): 서버가 보낸 시퀀스 번호에 +1을 한 값을 ACK에 저장하고 서버에 TCP 헤더 20 byte 전송
        * 헤더만 필요로 하는 경우의 동작은 페이로드가 없어도 시퀀스에 +1 값을 ACK로 하여 보낸다. 원래 데이터 송수신 시 페이로드만큼 +한 값이 ACK로 전달됨
    * <img width=650 src="https://user-images.githubusercontent.com/95362065/152457365-0d65b111-82bb-4a62-bd83-2f96c59678bc.PNG">
2. 4 way Handshaking 연결 끊기(aka close 함수)
    * <img width=650 src="https://user-images.githubusercontent.com/95362065/152459575-86be8c3e-89d6-4593-b22a-2bf9e019d71a.png">
    * FIN: "너에게 보낼게 없어" 느낌
3. 수신 (aka recv 함수)
    1) 윈도우: 수신측에서 recv 함수를 호출하지 않아도 받을 수 있는 버퍼 사이즈. 즉, 현재 당장 소켓 버퍼에 저장할 수 있는 버퍼 크기
4. 컨트롤 비트 RST
    * 일방적으로 접속을 파괴하겠다.
    * 유실의 가능성이 있지만 RST는 재전송을 하지 않는다. (+ACK를 회신받지 않는다.)
5. 컨트롤 비트 URG
    1) out of band(OOB): 소켓 송신 버퍼를 경유하지 않고 바로 전송하는 기능, 수신측에서 OOB를 지정해야 수신할 수있음. 최대 크기는 1byte이며, 잘 사용되지 않는다.

### TCP/IP
1. TCP 연결 정보는 Non-Paged pool(항상 물리메모리에 적재되어 Page out이 될 수 없는 영역) 메모리에 저장된다. (대상: 드라이버, 인터럽트 신호를 처리해야하는 하드웨어와 통신하는 친구들)
2. Keep Alive(Heartbeat): 현재 통신이 잘 이루어져있는지 주기적으로 확인하는 기능
3. TCP의 특징
    1) 연결 1:1
    2) 재전송, 100% 전송 보장
    3) 뭉쳐짐, 쪼개짐. => 스트림 방식
4. TCP의 스트림
    1) 뭉쳐지는 경우
        * Case1(송신측): 수신측 윈도우 사이즈(제로 윈도우)가 0인 경우.
        * Case2(송신측, 네이글 알고리즘): TCP로 송신할 데이터를 내부에서 버퍼링해서 쌓아두는 것. 기본적으로 항상 기능함(버퍼링 아웃 조건1: 상대방으로부터 ACK 왔다면, 조건2: MSS 사이즈에 도달했을 때)
        * Case3(수신측): 수신측이 Recv를 늦게하는 경우
    2) 쪼개지는 경우
        * 뭉쳐지는 경우와 같은 사유로 쪼개진다.
    3) Send 함수는 **소켓 송신 버퍼**에 복사한 후 반환된다.
    4) Recv 함수는 **소켓 수신 버퍼**에서 버퍼를 읽어온다.
5. Loopback은 MTU가 42억이다.
* 어떤 네트워크던 하이재킹이 가능하다.

## 기타 키워드
### TCP 관련 툴
1. TCP View: netstat 상위 버전
2. wireshark: 
    1) ip 필터링: ip.addr == (IP 주소)
    2) 처음 Seq가 0인 것은 해당 패킷의 Seq가 아니라 wireshark가 사용자가 보기 편하게 계산한 값이다.
    3) Shift Count: 윈도우(Wnd) 사이즈에 2^n승
    4) TCP Window Update: 수신측 윈도우가 갱신됨
