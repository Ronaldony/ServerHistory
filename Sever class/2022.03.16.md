# 2022/03/16 수업내용
## 직렬화 버퍼
### 입력 데이터의 타입
1. 입력 데이터 타입 설계 방법
    1) 방법1: 직렬화 버퍼에 입력되는 데이터를 단일 된 컨텐츠 형식으로 전달할 수 있다.
        <pre><code>
        // 기본 구조
        void 프로시저 함수(CPacket* clpPacket)
        {
            ...
            *clpPacket << CPlayer;
        }

        // 연산자 오버로딩 함수
        CPacket operator << (CPlayer& player)
        {
            // 컨텐츠에 따라 하나의 프로토콜이 된다.
            unsigned char len = sizeof(CPlayer);
            
            *buff = len;
            
            *(buff + 1) = player.x;
            *(buff + 2) = player.y;
            ...
        }
        
        // 응용 사례
        아이템목록
        {
            unsigned char itemcnt;
            {
                int itemid;
                int item1;
                int item2;
                int item3;
            } * itemcnt;
        }

        ItemList(list<ITEM *> ItemList)
        {
            Packet << ItemList;
        }
        </code></pre>
        * 특징: 직렬화 버퍼 자체가 하나의 프로토콜의 역할을 하게 된다.
        * 장점: 단일 된 프로토콜로 같은 컨텐츠는 직렬화 버퍼에 한 번만 입력하면 된다.
        * 단점: 같은 컨텐츠라도 나의 데이터, 다른 유저의 데이터가 필요한 정보가 다를텐데 프로토콜이 통일되다보니 필요없는 정보가 전달되는 경우가 있다. 

### 실제 구현
1. template로 구현하면 안 된다. 버퍼에 들어갈 데이터로 모든 타입을 받아들인다는 것인데 그렇게되면 우리가 정해놓은 규칙을 깨는 것이다.

## RPC(Remote Procedure Call)
### 직렬화 버퍼와 RPC의 관계
1. 직렬화 버퍼와 RPC의 관계: RPC의 개념은 한 측에서 함수를 호출하면 상대방 측에서 특정 함수가 호출되는 것이다. 이러한 입장에서보면 송신과 수신측에서 직렬화 버퍼의 연산자 오버로딩 함수 내에서 프로토콜을 정의하는 것이 나은 방법일 수 있다.
2. 보내는 측을 proxy, 받는 측을 stub이라 명한다.
3. RPC를 정한다는 것은 호출할 **함수**를 정하는 것이다. 이것 자체가 프로토콜이 되는 것이고, 보내는 데이터의 크기가 뭐다 순서가 어떻게 된다 라는 언급자체를 안 하는 것이다.

### 구글 등의 회사에서 제공하는 RPC 코드 생성
1. 이렇게 제공되는 코드들은 애플리케이션의 함수 호출 관계부터 네트워크 송수신 부분을 모두 포함하고 있다.
    1) 장점: 사용하기 간편하다.
    2) 단점: 네트워크 송수신까지 포함되어 있기 때문에 성능상에 한계가 있다.
2. RPC 코드는 IDL 파일로 출력이 되어 이를 우리 프로젝트에 포함해야 한다.
    1) IDL 파일을 읽고 송신측과 수신측에 각각 함수의 .cpp, .h 가 생성되고 .cpp에는 호출까지 생성이 된다.
    2) 고민해 볼 사항
        * 새로 빌드할 때마다 수신측 즉 stub.cpp에 프로시저 함수의 내부가 새로 덮어질텐데 어떻게 해결할 것인가? -> stub.h에서 Stub 클래스를 생성하고 내부에 프로시저 함수를 가상 함수로 정의를 해놓는다. 우리의 코드에서 이 Stub 클래스를 상속하여 함수 내부를 구현하는 방법이 있다. 이는 프라우드넷에서 이용하는 방법이다.
    
### 동기 RPC, 비동기 RPC
1. 동기 RPC: 송신측 입장에서 메시지 생성부터 네트워크 송신을 하고 수신측으로부터 결과를 기다리는 형태
    * 절대 안씀!
2. 비동기 RPC: 송신측 입장에서 메시지 생성 후 **송신 요청**까지만 하고 수신측의 결과를 기다리지 않고 다른 동작을 하는 형태

### 포트폴리오
1. RPC 구조 자동화하는 것을 구현하면 포트폴리오에 작성할 만 하다.
    * 메시지 생성부터 네트워크 송수신 메시지 수신까지 자동화시키는 것이 기본이다.

## 기타 키워드
### 패턴
1. Virtual 프록시: 필요한 정보 혹은 공간이 필요한 순간에 갱신하는 형태
2. Protection 프록시: 예외처리를 두어 서버를 한 번 감싸는 형태의 
3. Remote 프록시: 원격지에 있는 다른 컴퓨터의 함수가 호출되는 것(RPC를 구조적으로 표현할 떄 Remote 프록시라 함)

### GPG
1. 배현직 대표가 작성한 RPC 기고문 찾아보기

### 빌트 이벤트
1. 명령줄: 실행 파일 실행 시 commanline에 입력하는 옵션 지정
2. 빌드 전 이벤트: 여기서는 컴파일에 포함할 소스코드를 지정한다.
