# 2022/07/20 수업내용
# 네트워크 라이브러리
## 스레드
### 스레드와 메모리풀
1. 런타임 라이브러리가 스레드를 관리하고 있다.
2. 스레드의 종료 시점에 메모리풀 삭제를 고려하지 않고 설계할 것이다.

## 메모리풀
### TLS 메모리풀
1. TLS 공간을 저장해두어 각 풀마다 TLS와 매핑 테이블을 묶어두어 사용
2. 메인 메모리풀 이름을 MemoryPoolTLS로 지정

### 락프리 스택
1. 우리가 가장 간단한 자료구조를 만들 때 스택을 만든다.
    1) 간단한 구조라면 코드가 간결한 것이다. 이는 캐시히트율과 연관된다.
2. 비교: 락프리 큐와 스택은 상황마다 성능이 누가 나은지 장담은 할 수 없다. 그러나 각 상황에서는 이득이 되는 구조는 확실하게 정해진다. 락프리를 완벽히 이해했다면 정확하게 정할 수 있을 것이다.

### 청크 관리
1. 메모리풀 내부에서 Pool의 Max 치를 넘으면 Chunk 포인터에 쌓아두면서 

## TLS(스레드 지역 저장소)
### 관련 함수
1. SetWindowWord, SetWindowsLong: 윈도우(창) 핸들마다 관리되는 Extrabyte라는 공간에 저장되는 정보

### 런타임 라이브러리
1. 런타임 라이브러리는 TLS 기능을 FLS의 이름으로 기능을 지원한다.
    1) 이유: 범용적으로 Fiver에 대해서도 지원해야 하기 떄문에 이러한 함수 이름으로 되어 있다.
    2) 우리는 Fiver를 쓰지 않기 때문에 TLS로 사용이 된다.
2. Fiver(파이버)
    1) 유저 모드의 스레드 (경량 스레드)

### DLL
1. TLS에 의존적이다.  DLL을 사용하는 어플리케이션의 환경이 싱글 스레드일지 멀티 스레드일지 

### 동적 TLS
1. 윈도우 API 차원에서 제공된다.
    1) 스레드를 만들때 기본적으로 생성되고 안 쓰면 낭비가 되는 대상이다.
    2) Index
2. 함수
    1) TlsGetValue
        * 
    2) TlsSetValue
    3) TlsAlloc
        * 사용가능한 Index를 반환해줌. TLS_OUT_OF_INDEXES 반환 시 인덱스 초과
        * 같은 프로젝트 코드에서 TLS의 Index가 중복되어 사용되면 덮어써져버리는 문제가 발생한다. 따라서 Index 또한 따로 할당을 받아 사용하자! 는 아이디어가 나온다. 
        * 위 문제에 따라 
    4) TlsFree
        * TlsAlloc된 Index를 반환
3. TLS 공간은 0으로 초기화하는 것을 보장한다.
    1) 우리는 여기에 의존한 코드를 짤 것이다.

### 정적 TLS
1. __declspec(thread)
    1) 
    2) 정적이나 전역 변수로 사용된 변수에만 적용됨
2. TLS라는 섹션이 생겨난다. 이는 스레드마다 붙게 된다.

### 값의 초기화
1. 지역변수는 왜 초기화되지 않을까?
    1) 이유 1: 처음 사용이 된다라는 것을 보장해주지 않아도 되기 때문이다.
    2) 이유 2: 반복 호출로 인한 성능 문제
2. 전역변수는 왜 0으로 초기화될까?
    1) 처음 사용되는 시점을 보장하기 위하여

### 정적 TLS
1. 언어적인 차원에서

## 포트폴리오
### 락프리 큐와 스택
1. 큐와 스택이 어느 상황에서 사용되었을 때 

## 기타
### 동적 메모리 할당
1. 고성능을 요구하는 시스템에서는 malloc을 사용하지 않는다. 동기화가 들어가기 때문에
2. Jmalloc, pcMalloc

### C++ 20
1. 코루틴을 정식으로 유저 모드의 스레드 
