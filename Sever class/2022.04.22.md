# 2022/04/22 수업내용
## TCP 파이터 서버
### 프레임 관련 문제
1. 싱크 메시지가 발생한 시점에 비정상적인 싱크인지 정상적인 싱크인지 파악하는 로그를 출력하여 
  * 만약, 갑자기 서버 부하가 커져 1초 동안 900ms동안 로직이 못 돌다가 100ms내에 갑자기 프레임을 채웠다. 
  * 각 프레임에 대한 최대, 최소 간격을 구하여 문제를 파악해야 한다. => 이 상황은 어느 지점에서 
2. 실제 게임에서 반영
    1) 느려지면 느려진대로 프레임을 돌리는데 이때 지나온 시간만큼 이동 값을 곱하여 한 번에 이동처리를 하는 방법
    2) Fixed update: 기회가 왔을 때 이전에 부족분을 지금 당장 채우는 것 => 하지만 부족분을 채울 때 단순하게 처리하면 프레임간 시간이 정말 작은 시간이기 때문에 프레임마다의 시간이 0이 되어버린다. 만약 이 상황에서 DeltaTime 기준으로 충돌 및 이동처리를 하였다면 정상적으로 처리되지 않는다.
        * 위 문제를 해결하기 위해 유니티에서는 프레임마다의 시간을 실제 시간이 아닌 원래 정상적인 프레임 간의 시간으로 변경하여 충돌 및 이동 거리를 맞추게 된다.
        * 유니티에서는 Speed 라는 개념이 있는데
        * 이 방법은 
3. 서버와 클라의 프레임
    1) 이제는 클라가 좌표를 실수로 가기 때문에 서버는 프레임 기준으로 
    2) 
4. 서버가 느려졌을 때의 처리 기준
    1) 프레임 기준: 모든 월드의 시간이 느리게 감
        * 문제: 벽을 비비면 뚫고 감
    2) 델타타임 기준: 
    * 애초에 프레임이던 델타타임 기준이던 서버가 느려지면 느려진대로 게임이 진행되는 건 어쩔 수 없다.

## 스레드 프로그래밍
### 최소 단위 오퍼레이션(=Atomic 연산자)
1. 정의: 작업을 하는 동안에 컨텍스트 스위칭이 되지 않는다를 보장하는 오퍼레이션
    * 보통 어셈블리어 명령어에 해당하는데, 모든 명령어가 최소 단위 오퍼레이션은 아니다.
2. 스레드가 한 번 스케줄링되면 최소한 Atomic 연산자를 1번 이상 완료하고 

### 스케줄링
1. Block된 스레드 관리
    1) 의문: Block된 스레드의 관리가 어떻게 되길래 Sleep, IO 작업 등을 기다릴텐데 어떻게 시간복잡도가 1일까? => 시간: 짧은 시간 순서대로 정렬을 하고 맨 앞단만 바라봄. IO 작업: 커널 오브젝트를 처리하는 스레드가 Signal 상태를 기다리는 스레드의 Block 관련 정보를 바꾼다.(내용 수정) 
    2) 보통 스케줄링되는 자료구조들은 검색 시간복잡도가 1이다. CPU에는 영향이 없다. => 의문
2. 스레드의 개수는 제한이 없다. 물리메모리의 제한이 있을 뿐
3. 기아현상과 우선순위 부스팅
    1) 기아현상을 방지하기 위하여 강제적으로 OS가 개입하여 돌지못하는 스레드들을 돌린다.
        * 1초에 한 번 식 밸런스 셋 매니저 스레드(커널 스레드)가 레디큐를 스캔하여 준비 상태에서 4초이상 머물고 있는 스레드가 있는지 살펴본다. 이런 스레드가 있다면 우선순위를 최대치로 올리고 수행 후 다시 본래의 우선순위로 돌아온다. 밸런스 셋 매니저는 모든 레디 스레드를 검사하지는 않으며, 16개씩만 검사한다.(모든 스레드를 하면 부담이 되기 때문에) 또 한번에 최대 10개의 스레드에 대해서만 우선순위를 상승시킨다. => 수치는 외우지 말고 개념만 익힐 것

### 타임 슬라이싱
1. 스케줄러는 방금 작업이 끝난 스레드의 작업이 끊나면 레디 큐에 넣은 후 같은 우선순위의 스레드를 CPU에 할당한다. => 애초에 자신(CPU에 선점되었던)보다 높은 우선순위의 스레드는 레디큐에 존재하지 않기 때문
2. CPU 이용률이 낮다 => 레디 큐가 대부분 비어 있다.
