# 2022/06/15 수업내용
# 네트워크 라이브러리
## 고민 거리
### 직렬화 버퍼와 메모리풀
1. 직렬화 버퍼를 지역으로 두었을 때 항상 동적으로..
2. 메모리풀 Alloc과 Free 를 독립적으로 동기화 시킬 수 있는지..

## 락프리 구조
### 세션맵 개선
1. 세션맵에대한 Lock
    1) SendPacket을 진입 시 항상 세션맵 Lock을 걸고 
    2) 구조에 대한 개선에 대한 고민 사항
        * 고민 사항1: 컨테이너 오작동
        * 고민 사항2: 자원에 대한 해제
2. 세션맵 구조 개선
    1) 컨테이너에서 배열로 전환
    2) 배열을 어느정도 크기로 정할 것인가?
        * 우리는 상수로 정할 것이다. 
    3) 문제 사항: 세션을 순회하며 검색을 해야 하는 단점이 생긴다. 그러나 이것도 개선시킬 수 있는 방안을 생각해보자
3. 세션맵 배열
    1) 세션
        * 
    2) 검색 - 아이디어1: 비어있는 세션에 대한 배열을 하나 더 두어 세션맵을 검색하는 방법
        * 아이디어 목적: 한 캐시 라인에 가두어 
        * 구조: 1비트 당 1세션에 대한 상태를 보관한다. 8byte라면 64개의 세션을 검색할 수 있는
        * 검색: 처음부터 비트마다 마스킹하여 검색하는 것이 아닌 크게크게 단위별로 검색을 우선적으로 한다. (예시: 전체 -> 8byte -> 비트 단위 별)
4. Lock에 대한 고찰
    1) 정상적인 상황에서 WSARecv나 WSASend 호출 후 세션을  의 IOCount로 인한 릴
    2) 비정상적인 상황에서 WSARecv나 WSASend
    3) Flag를 interlockedExchange를 해야 하나?
        * 논리적으로는 필요없다. 그러나 Out-of-ordering 문제에 대하여 고민해보아야한다.

## 기타
### Out-of-ordering
1. 학원에서 Lock을 안 썼을 때 Out-of-ordering 문제가 날 수 있는 상황을 고민해보자. 그리고 또 발생하는지 확인해보자
