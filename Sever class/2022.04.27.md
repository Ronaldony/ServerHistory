# 2022/04/27 수업내용
## 스레드 프로그래밍
### 스레드
1. 공부: STD 사용법을 익히지 말고 STD 스레드를 분석할 것. 우리는 STD 스레드를 사용하지 않고 만들어서 사용할 것이다.
2. 스레드 커널 오브젝트와 스레드는 다른 의미이다. 스레드가 스레드 객체를 바라보고 있다.(수정)
3. 스레드 생성
    1) CreateThread 시 참조 카운트는 처음부터 2이다. (부모 스레드와 자신)
    2) 스레드 ID는 컴퓨터에서 유일한 값이다.
    3) Suspend의 목적: 보통 테스트 용도로 사용된다. 락프리 등의 성능을 테스트를 할 때 여러 스레드를 생성할텐데 생성 시 Suspend를 하고 나중에 ResumeThread를 호출하여 한 번에 스레드를 깨워 테스트한다.
4. 스레드의 매개변수
    1) 용도: 보통 똑같은 코드의 스레드가 여러개 생성될 때 어떤 스레드인지 구분하기 위해서 사용
5. 스레드 ID
    1) 남의 스레드 ID는 알 수 없다. 그래서 우리는 스레드를 생성할 때 보관한다.

### 스레드 커널 오브젝트(커널 영역)
1. 스레드를 구분하기 위한 것은 핸들과 스레드 ID로 구분하는 것을 사용할 수 있는데 스레드 ID를 얻어오는 것이 부담이 덜 된다. 그 이유는 핸들은 객체를 통해서 얻어야 하지만 스레드 ID는 레지스터에서 가져오기 때문이다.
    * 스레드 ID는 각 스레드의 레지스터 셋에 저장되어 있다. 

### 스레드의 종료
1. 종료 코드는 스레드 객체에 저장된다. 스레드의 종료를 확인할 수 있는 방법은 2가지이다. 객체 상태(signaled, non-signaled)와 종료 코드를 확인하는 방법. 정석은 객체 상태를 보는 것이다.
2. 최근에는 TerminateThread를 하여도 해당 스레드의 스택은 정상적으로 정리된다. 그러나 절때! 사용하지 않음
    * 스레드가 타의에 의해 종료되면 해당 스레드가 하던 일을 잃어버리게 된다.

### 대기 카운트
1. SuspendThread 시 1증가, ResumeThread 시 1감소
2. 스레드를 제어한다라는 의미는 다른 스레드를 대기, 종료 등을 제어한다는 것이 아니다. 스레드 간 통신을 통하여 어떠한 동작을 행하게 한다는 의미가 있는것이다.

### Sleep(0)과 switchToThread
1. switchToThread와 Sleep(0)과 동일하게 퀀텀 타임을 포기한다.
    1) 차이점(예전): Sleep(0)은 자신보다 우선순위가 같거나 높은 스레드가 있을 때만 실행 권한을 넘겨준다. 그러나 switchToThread는 자신보다 우선순위가 낮은 스레드 또한 다음 실행의 대상이 된다.
    2) 차이점(최근): 최근에는 Sleep(0)과 switchToThread는 자신보다 우선순위가 낮은 스레드 또한 다음 실행의 대상이 된다.
    3) 의문점: 퀀텀 타임을 포기한 뒤에 해당 스레드가 어떤 코어의 레디큐로 들어갈 지, 새로운 실행 대상이 우선순위가 낮은 스레드가 되는 경우 어떻게 이러한 동작을 함수 수준에서 가능한 것인지 등

### 스레드와 C 런타임 라이브러리
1. 스레드마다 getptd 함수를 통해 ptd 공간을 부여받는다.
2. 

### 우선순위
1. 상황: 네트워크 파트와 게임 로직 파트 중 어느 파트에 우선순위를 높일 것인가?
    1) 첫 번째: 게임 로직 파트 우선순위를 높임
    2) 두 번째: 
2. 데이터베이스는 무조건 우선순위 최상이다.
3. 모니터링 정보와 같은 큰 텀으로 동작하는 스레드들은 우선순위를 올려볼만하다.
4. IO 작업을 마치고 Block에서 레디큐에 올라갈 때 그때만 2~3을 올린다.
    * 

## 기타 키워드
### 스레드와 동기화 객체
1. 스레드와 동기화 객체 쪽은 자주 바뀐다. 이러한 것들은 문서와 어셈블리 분석이 가장 정확하다.

### 면접 질문
1. 스레드의 우선순위를 높일 것인가? 높이지 않을 것인가?
    1) 높인다:
    2) 높이지 않는다: 
2. 스레드의 우선순위를 변경하면 벌어지는 일
    1) 상황: 2개 이상의 스레드가 같은 우선순위였는데 몇개의 스레드의 우선순위를 높였다. 이전 상황과 이후 상황의 차이점은?
    2) 고정된 시간: 만약

### 스레드 우선순위 모니터링
1. windows 관리도구(제어판) -> 성능 모니터 -> 그래프에서 카운터 추가 -> Thread 항목 선택 -> 
