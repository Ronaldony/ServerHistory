# 2022.01.26 수업내용(복습 완료)
## 네트워크
### Frame 전달 과정
<img width=800 src="https://user-images.githubusercontent.com/95362065/151129255-e94b3caf-42e6-4c1f-a5e9-e09627a9e486.png">

### L2 스위치(허브)
1. L2 스위치
    1) 더미 허브(예전): 허브에 연결되는 포트를 모두 묶어 버림으로써 Broadcast 효과가 난다. 
        * Broadcast 처럼 보이는 것이지 실제로는 Broadcast와 다르다. 이유는 더미 허브에서 나간 Frame에는 도착지 주소가 적혀있어 도착지와 다른 주소의 장치들은 이 Frame을 모두 버린다.
        * 더미 허브의 단점: 속도가 묶여있는 포트 만큼 줄어든다. 양쪽에서 동시에 데이터가 들어오면 데이터 충돌이 일어난다.(때문에 Collision이라는 충돌 LED가 달려있다.)
    2) Mac Table
        * 들어오는 Mac 주소를 모두 수집하여 몇번 포트에 있는지에 대한 정보를 저장하는 테이블
        * 생성 과정
        * <img width=600 src="https://user-images.githubusercontent.com/95362065/159196454-5a17823b-7f6a-409c-84fe-9bb5e799edc5.gif">
    3) L2 스위치는 포트당 제공하는 속도를 표기하여 판매한다. 그리고 RAM 크기마다 Mac Table 크기가 달라진다.
    4) LAN을 확장 시킬 때 L2 스위치의 포트를 무작정 늘리는 것은 잘못된 설계이다. 생각보다 Broadcast 동작을 많이하기 때문에 네트워크 환경에 많은 부하를 줄 수 있다.
        * 따라서, 용도와 꼭 필요한 장치끼리 나누어 LAN으로 묶는 것이 효율적이다.
    * OSI 계층에서의 L2 스위치는 목적지의 역할을 할 수 없는 L1의 장치로 보는 경향이 크다.

### L3 스위치(공유기)
1. 공유기는 L3 스위치 + NAT 기능을 가진 장치로 본다. IP를 가지기 때문에 목적지로서의 역할을 할 수 있는 장치로 인식된다.
2. Frame 수신 시 공유기 장치안의 L3->L2 계층을 거쳐 다음 라우터의 L3 계층으로 이동한다. 이 동작을 반복
3. NAT 기능이 포함되지 않는 이상 Frame의 IP, TCP(포트) 주소는 절대 바뀌지 않는다.

### L4(aka 로드밸런서)
1. L4 스위치는 로드 밸런서의 역할을 한다(사실 주기능). 같은 기능을 하고 사설 IP를 부여받은 컴퓨터를 여러개 연결해두고, NAT 기능을 사용해 각 컴퓨터에 전달하여 부하를 분산시킨다.
    * 왜 L4부터 로드 밸런서의 개념이 나왔나? => TCP 연결, 세션을 기억하고 관리하기 위한 방법이다. 때문에 L4 스위치는 동시 처리 가능 세션 수라는 스택의 개념이 나온다.
    * L4 스위치는 고가여야 한다. 클라이언트의 요청이 모두 L4 스위치로 전달되어 연결된 여러개의 서버로 전달되기 때문이다.
2. L4 계층에서 최종적으로 포트 번호를 가지고 목적지를 판단한다. 때문에 하나의 도메인, 하나의 IP에서의 서비스(메일, 웹 페이지, 게임 등)라도 서버가 실제적으로는 각기 다른 서버일 수 있다.

### L7
1. L7 대부분이 HTTP 프로토콜 장치이다.
2. HTTP 헤더를 분석하여 막던가 받던가

### 각 계층의 스위치 설명
1. L2 스위치는 MAC 정보(MAC Table)를 보고 스위칭을 하는 것이고,(일반적인 스위치의 기능)
2. L3 스위치는 IP 정보(Routing Table)를 보고 스위칭을 하는 것이고,(라우팅 기능이 추가됨)
3. L4 스위치는 Port(Session or Connection)를 보고 스위칭을 하는 것이며,(로드밸런싱을 위해 사용됨) 

### IP 헤더
1. 뻉뺑이 루프 도는 경우
    1) 초창기에 아무도 부여받지 않는 IP를 가는 경우
    2) IP 설정을 잘못한 경우
2. TTL: 뺑뻉이 루프를 방지하기 위한 생존 기간. 라우터를 거칠 때마다 1씩 감소한다.
    * TTL이 0이 되면 해당 라우터가 발신자에게 ICMP 기능을 사용해 폐기하였다고 알려준다.
    * tracert 명령어는 이 TTL을 1씩 증가시키며 ICMP로 폐기된 frame을 수신한 정보를 출력한다.

## TCP/IP 프로토콜
### 인터넷 계층
1. ARP 스푸핑(ARP spoofing)
    1) LAN에서 ARP 메시지를 이용하여 상대방의 데이터 패킷을 중간에서 가로채는 중간자 공격 기법이다.
    2) 네트워크 환경 관리자 측에서 ARP 스푸핑을 관리해줘야 한다.
2. ICMP
    1) 프레임의 오류를 검지하여 패킷의 폐기 여부를 송신자에게 알려주는 프로토콜
        * ping이 ICMP를 활용하여 구현한다.

### NAT(Network Address Translation)
1. 패킷에 있는 출발지 및 목적지의 IP 주소 포트 번호를 변경하는 기술

## 기타 키워드
### 허브
1. PPS: 초당 몇천만건의 패킷을 처리하는 용량

### 포트 번호
1. 0번 ~ 1023번: 잘 알려진 포트 (well-known port) => 여기서의 포트 번호는 서비스 서버쪽에서의 포트 번호이다.
2. 1024번 ~ 49151번: 등록된 포트 (registered port)
3. 49152번 ~ 65535번: 동적 포트 (dynamic port)

### 쉘 명령어 모음
1. arp -a: ARP 테이블 보기
2. route PRINT: 라우팅 테이블 보기
3. ping: 보통 방화벽에서 외부로부터의 Ping을 막는다. Ping이 된다는 것은 L3 계층에서는 문제가 없다는 뜻이다.
    * Ping이 되지않는다 -> 방화벽부터 열어야 한다.(인바운드 규칙에서 파일 및 프린터 공유(ICMP) 추가)
4. netstat: L4 계층(TCP, UDP 등)에서의 연결 정보 모니터링, netstat -an: 모든 포트의 외부 주소를 포트 번호로
5. tracert: 지정된 호스트에 도달할 때까지 통과하는 경로의 정보(L3)와 각 경로에서의 지연 시간을 추적하는 명령이다.
    * 외국에서 서비스 시 해당 국가의 센터에 서버를 구비하지 못하는 경우, 주변 국가에서 해당 국가로의 ping 응답 혹은 tracert 경로가 짧은 것을 선택해야 한다.
    * 외부와의 통신이 안 되는 경우 해결 절차: ping -> 방화벽 검사 -> tracert를 해서 어디까지 가는지 확인, 어느 시점의 라우터 이후 뺑뺑이 루프 또는 해당 구간에서 방화벽(ICMP를 안 보냄)으로 막히고 있다!

### 랜카드를 많이 꽂는다는 것
1. Case1: 하나의 PC를 용도별로 여러 LAN에 존재하게하기 위한 목적이 있다. LAN의 트래픽이 개선된다.
2. Case2(보안 목적): 사설 IP와 공인 IP를 분리한다. DB는 공인 IP로 묶여서는 **절대** 안 된다. 때문에 게임 서버는 랜카드를 2개 이상을 두어 하나는 DB에 하나는 공인 IP(클라이언트와의 통신 목적 등..)에 연결한다.
3. 특이한 케이스
    1) Frame이 해당 네트워크 이름으로 나가지않고 게이트웨이로 간다. -> 해결 방법: 라우팅 테이블의 메트릭을 조절해야한다.

### Broadcast
1. 동일한 네트워크 이름을 가진 모든 호스트에게 Frame을 전송한다. 송신자는 한 번만 전송하되 연결된 모든 장치에 Frame이 전달됨
