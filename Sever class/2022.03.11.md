# 2022/03/11 수업내용
## TCP 파이터 클라이언트 과제
### 서버-클라 구조
1. 보통 PC게임은 네트워크가 끊기는 경우를 제외한다. 단, 끊길 시 타이틀(로그아웃)로 돌아가는 식으로 구현하여야 한다.
    * 모바일의 경우 네트워크가 끊기는 경우가 많기 때문에, 30초~1분 정도 대기 후 재연결하여 게임을 이어서 진행시킬 수 있도록 구현하여야 한다.

### 메시지 처리
1. 메시지 처리에 대한 프로시저 함수의 매개변수를 통일시켜야 한다.
    * 꼭 메시지 하나당 하나의 프로시저 함수 설계!!
2. 메시지 하나에 대해 하나의 메시지 함수만 호출되게 해야한다. 즉, 클라의 하나의 동작 메시지의 요소들을 뜯어서 하나하나 함수를 호출하는 것이 아닌 최소한의 함수를 사용하여 메시지와 처리 함수 호출의 비율을 최대한 일치시키는 것이 좋다.

### 메시지 생성
1. 패킷 데이터 생성은 각각의 패킷마다 생성 함수를 별도로 만들어서 패킷 데이터 생성코드를 생성한다.
2. 메시지 생성 함수 설계 시 최대한 메시지 요소들을 데이터로 풀어서 매개변수로 입력되어 메시지를 생성하게 하는 것이 좋다.
    * 메시지 변경 시 변경된 메시지에 대해서만 수정하는데 용이하다.
    * 또한 메시지 처리, 메시지 생성 함수는 따로 .cpp를 만들어 관리해야 한다.
 
## 게임 구조
### 프레임 기준 구조
1. 프레임 스킵
    1) 프레임 시간이 부족한 경우 렌더링을 포기하고 로직을 늘리는 방법이다.
2. 2D의 경우 스프라이트 한 장 한 장을 기준으로 렌더링하기 때문에 클라이언트는 프레임 기준으로 하지만, 서버는..?
    1) 서버의 경우 

### 시간 기준 구조
1. Delta time 처리
    1) 로직 처리: Delta time * speed 로 로직 처리가 이루어진다. 이는 시간을 기준으로 키 프레임에서 애니메이션을 만들어가기 때문에 가능한 방법이다.
2. Fixed Update
    1) 위의 프레임 스킵과 반대인 개념으로 Fixed Update를 항상 50FPS까지 맞춰준다. 때문에 Fixed Update에 로직부분을 넣는다.(Update는 늦으면 늦는대로 호출된다.) 
3. 언리얼의 리지드 바디를 사용하지 않는 경우 Delta time

### 길 찾기
1. 서버의 길 찾기
    1) 서버가 하는 경우 타일 단위(사각형, 그리드)로 길 찾기를 구현한다.
    2) 캐릭터는 타일의 어느 위치에 서도 타일의 중앙을 기준으로 길을 찾는 형태이다. 또한, 타일 이동 갯수를 기준으로 이동 시간을 계산한다.
    3) 옛날엔 그리드 방식, 월드 좌표를 , 현재는 클라의 월드 좌표가 주 좌표 
2. 클라의 길 찾기
    1) 클라가 하는 경우 폴리곤(삼각형 면)으로 길 찾기를 구현한다.
    * 따라서 서버-클라 주체에 따라 좌표의 값이 달라진다.
3. 서버-클라
    1) **예전** 클라에서는 월드좌표가 주, 필요하다면 그리드 좌표가 보조였다. 서버에서는 그리드 좌표가 주, 월드좌표가 보조였다.
        * 따라서 서버에서는 처리된 그리드 좌표를 월드 좌표로 환산하여 클라로 전달하였다.
    2) **현재**는 클라에서는 월드좌표가 주, 필요하다면 그리드 좌표가 보조이다. 서버에서도 동일하다.
4. 현재에도 그리드 좌표가 필요한 이유
    1) 길 찾기 이외 다른 컨텐츠(조사 필요)에서는 그리드 좌표가 필요한 경우가 있다.
    * 보통 그리드는 2의 승수로 떨어지는 수로 정한다.

### 서버의 구조
1. 서버에서는 프레임 스킵, Fixed Update를 고민할 필요는 없다. 프레임이 떨어져도 할 수 있는 것이 없다.
    * 따라서, 서버를 시간 기준으로 설계함으로써 프레임이 떨어져도 정상적으로 처리할 수 있도록 해야한다.

### 좌표
1. pixel이라는 단위로 좌표를 표현하면 오차가 커진다. 따라서, 실무에서는 대부분 실수형 변수로 좌표를 표현한다.
    * 모니터 상에서의 좌표가 아닌 월드 상에서의 단위로 좌표를 인식해야 한다.

## 기타 키워드
### 언리얼
1. 언리얼 데드케이티드 서버가 애매한 부분
    * 이 서버를 사용하는 배그에서 핵이 나오는 것을 보면 완전한 서버-클라 구조가 아니라고 판단된다.
