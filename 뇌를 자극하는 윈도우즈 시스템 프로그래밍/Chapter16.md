# Chapter16 컴퓨터 구조에 대한 네 번째 이야기
## Section01 메모리 계층
### 메모리의 범위와 종류
1. 메모리라 불릴 수 있는 후보
    1) 메인 메모리: D-RAM
    2) 레지스터
    3) 캐시: 캐시는 D-RAM보다 빠른 S-RAM으로 구성되며 CPU와 램 사이에서 중간 저장소 역할을 한다.
    4) 하드 디스크와 이외 저장 장치들
2. 저자는 레지스터, 캐시, 메인 메모리, 하드 디스크뿐만 아니라 그 밖의 I/O 장치들과의 입출력 타이밍 및 대기 시간 등을 가장 중요한 요소로 생각하고 고민해야 한다고 강조한다.

### 메모리 계층 구조
1. 메모리들의 가장 큰 차이점은 **CPU로부터 얼마나 멀리 떨어져** 있느냐이다. CPU와 가까이 있을수록 빠르고, 멀리 있을수록 속도가 느리다.

### Level1(L1) 캐시와 Level2(L2) 캐시
1. 시스템의 성능을 좌우하는 클럭속도는 **항상 느린 쪽에 맞춰지게** 되어 있다. 오늘날 CPU의 속도가 상당히 빨라진 것과 비교해 메인 메모리의 속도는 따라가지 못하고 있다.
    * 이러한 문제로 인하여 CPU의 연산속도가 아무리 빨라져도 컴퓨터의 성능이 최고의 성능을 내지 못하는 이유이다.

## Section02 캐시와 캐시 알고리즘
### 컴퓨터 프로그램의 일반적인 특성
1. 템퍼럴 로컬리티: 한 번 접근이 이뤄진 주소의 메모리 영역은 자주 접근하게 된다는 프로그램 특성을 표현할 때 사용하는 말이다.
2. 스페이셜 로컬리티: 메모리 접근  이미 접근이 이루어진 영역의 근처일 확률이 높은 특성을 말한다.
3. 위에서 언급한 두 특성으로 인하여 캐시가 성능 향상에 많은 도움이 된다.

### 캐시 알고리즘
1. CPU는 L1 캐시에 데이터가 없으면 L2 캐시에서 데이터를 찾는다. 이 때 L2 캐시에 데이터가 있다면 블록 단위로 데이터를 가져온다.
    * 블록 단위로 데이터를 가져오는 특성은 **스페이셜 로컬리티** 특성을 가져온다.
2. 캐시의 공간이 가득 차 있는 경우 캐시 교체 정책에 따라서 특정 데이터를 캐시에서 밀어낸다.(제거한다)
    * 가장 많이 거론되는 교체 정책은 **Least-Recently Used(LRU)** 알고리즘이다.

## Section03 가상 메모리
### 물리주소
1. 프로그램이 실행되려면 항상 램에 적재되어 실행되어야 한다. 그렇다면 램보다 큰 용량의 프로그램은 어떻게 실행되는 것일까?

### 가상 주소 시스템 1
1. windows는 메모리의 **가상** 개념을 사용하여 램보다 큰 프로그램을 실행시킨다.
    1) 가상 주소 지정(Virtual Addressing): 가상의 주소를 지정하는 것
    2) 가상 메모리 공간: 가상 주소 지정을 통해서 할당받게 되는 메모리 공간(32bit 에서는 4GB, 64bit에서는 8T)
2. 가상 주소 시스템이 해결해야하는 문제
    1) 선 할당으로 인한 부담: 조그만 프로그램에도 4GB 메모리 공간을 할당할 것인가?
    2) 느린 속도의 개선 필요성: 만약 4GB 프로그램을 하드디스크에 저장한다면 속도가 느릴 것이다.
    * 프로그램은 4GB를 할당하였다 해도 4GB 전부를 사용하지 않는다는 특성이 있다. 이 특성은 위 문제를 해결할 수 있는 실마리를 갖는다.
3. MMU
    1) CPU와 함께 패키징되는 하드웨어 장치로, CPU가 요청하는 메모리를 할당해주는 역할을 한다.
    2) MMU는 가상 메모리에서 메모리의 할당과 주소 변환에 관련된 내용들만 처리한다.
4. Page
    1) 메인 메모리와 가상 메모리는 동일한 일정 크기로 메모리 블록을 나눈다.(이를 Page 블록이라 칭하자)
    2) Page Frame: 하드웨어 입장에서의 Page 블록       => 실제 메인 메모리 블록
    3) Page: 소프트웨어 입장에서의 Page 블록           => 가상 메모리 블록
    4) Page Table
5. 가상 주소에서 물리 주소로의 변환
    * <img width=600 src="https://user-images.githubusercontent.com/95362065/150131152-cbecb740-5b73-448d-bd21-d02889b9b466.png">
    * p: 가상 주소 페이지 번호, f: 메인 메모리에서의 페이지 번호, d: 페이지 안에서의 Offset

### 가상 주소 시스템 2
1. 램과 하드디스크는 페이징(Paging)을 통하여 메인 메모리를 확장한다.
