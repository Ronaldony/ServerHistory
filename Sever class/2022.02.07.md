# 2022/02/07 수업내용
## 네트워크
### TCP/IP
1. 송신 시 PSH, ACK를 Set 하는 이유
    1) ACK: 일반 데이터 송신시에도 그냥 보낸다.
    2) PSH(flush): 수신측에서 recv 함수를 호출하면 호출 스레드 상태가 block 된다. 이 block 상태를 풀게하는 것이 이 PSH 컨트롤 비트이다.
        * send(14600)를 호출 하였을 때 마지막 1460 패킷을 송신할 때만 PSH가 1로 세워진다.
2. Windows는 수신 확인 응답을 윈도우 제어 방식을 사용한다.
3. TCP 스트림: 패킷 데이터가 쪼개지는 경우
    1) 수신측의 윈도우 사이즈가 여유롭지 않은 경우
    2) 송신측에서 MSS가 여유롭지 않은 경우

### Reliable UDP
1. TCP 프로토콜을 바탕으로 설계, 동작 방식, 구현 방법 등 제작하는 방법을 강구해놔야 한다.

### 공유기
1. 작동 방식(내부->외부, 동적)
    1) 사설 PC -> NAT 장비: Src IP(192.168.0.xx)와 포트번호(20000)가 송신한 PC로 설정된 패킷이 NAT 장비에 전달된다.
    2) NAT 장비 -> 게이트웨이: 전달받은 패킷의 Src IP와 포트 번호를 NAT 장비의 IP와 게이트웨이로 연결되 포트번호로 바꾼다.
    3) 이 때 포트 포워딩 테이블을 만듦
    4) 이후 게이트웨이에서 데이터가 수신되면 포트 포워딩 테이블을 들여다보고 매칭되는 사설 IP&포트번호로 헤더를 변경하여 해당 포트로 송신한다.
2. 작동 방식(외부->내부, 고정)
    * 공유기의 NAT/라우터 관리에서 포트포워드 설정을 변경하여 외부에서 내부로 연결할 수 있게 한다.
    * 그래서 P2P에서는 홀펀칭, 클라-서버 형태로 게임이 서비스 된다.
3. 포트 포워딩 테이블 최대 개수
    * 128K(64K씩 TCP + UDP)
4. 방화벽은 터널링, NAT 방식으로 나뉘어진다. 일반적으로 방화벽은 NAT 방식이다.

### 홀펀칭
1. 랑데뷰 서버를 이용한 홀펀칭
    1) 서버 역할을 할 PC가 랑데뷰 서버에 연결을 요청하여 포트 포워딩 테이블을 만든다.
    2) 랑데뷰 서버가 다른 유저(클라)PC에게 서버 PC의 IP와 포트 번호 정보를 건네준다. 유저 PC는 이 정보를 바탕으로 서버 PC에 연결한다.
        * TCP라면 서버PC가 랑데뷰 서버 1:1 통신을 하고 있기 때문에 클라 PC가 연결하여도 의미가 없다. 따라서 주로 UDP로 홀펀칭을 함
2. 공유기는 세션 정보를 잘 알고 있어 홀펀칭 성공 확률이 적다.
* 프라우드넷이 홀펀칭으로 유명함.

### 릴레이 서버
1. 릴레이 서버
    1) 릴레이 서버는 각각 서버 PC와 유저 PC와 연결을 한다.
    2) 릴레이 서버는 서버 PC로부터 받는 데이터를 유저 PC로, 유저 PC로부터 받은 데이터를 서버 PC로 중계하는 역할을 한다.

### 네이글 제어
1. 네이글 off 방법: setsockopt 함수에서 TCP_NODELAY 옵션을 지정하면 된다.
2. 실제 서버에서는 네이글 on이 비용면에서 좋다.
    * 따라서 서버에서는 네이글 on, 클라에서는 off 방식을 선호한다.
3. 마우스 조작 게임인 경우 네이글 on이어도 부자연스럽지 않다.
    * 클라에서 해당 조작에 대한 이펙트, 캐릭터의 움직임 정도로도 유저가 느끼기에 자연스럽기 때문이다.
4. 데이터 송신 시 ACK 번호(+ACK 비트 on)를 함께 실어서 보내기 때문에 네이글이 **생각보다 잘 작동**되지 않는다. (이전 시간에 했던 송신 동작의 조건 두 가지를 잘 생각해보자)

## 기타 키워드
### 클라우드
1. Azure-하이퍼 V: x64 시스템을 위한 하이퍼바이저 기반의 가상화 시스템
2. 클라우드 서비스 사용 시 고정 IP를 사용하고자 한다면 렌탈 개념으로 비용을 지불해야 한다.
3. 베어메탈, KT 클라우드 서비스에서는 가상 서버를 많이 사용하는 유저에게 고정된 물리 서버로 전환하라는 호객 행위를 한다.

### SYN Flooding와 같은 공격을 대비하기 위해서는 그에 맞게 서버를 설계해야 한다.
