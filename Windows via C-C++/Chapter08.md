# Chapter08 유저 모드에서의 스레드 동기화
## Section01 원자적 접근: Interlocked 함수들
### 원자적 접근
1. 원자적 접근: 어떤 스레드가 특정 리소스를 접근할 때 다른 스레드는 동일 시간에 동일 소스에 접근할 수 없는 것
2. MS는 다양한 인터락 계열 함수를 지원한다.
    * 인터락 함수들은 CPU 플랫폼마다 동작 원리가 다르다. x86 계열의 CPU는 인터락 함수들이 버스에 하드웨어 시그널을 실어 다른 CPU가 동일 메모리 주소에 접근하지 못하도록 한다.
    * 인터락 함수에 전달하는 주소 값은 Alignment 되어 있어야 한다. 그러지 않은 경우 함수 호출 실패
3. 인터락 함수의 장점
    1) 매우 빠르게 동작
    2) 유저<->커널 모드 전환이 발생되지 않음
4. 인터락 함수를 사용한 스핀락 구현
    <pre><code>
    // 리소스의 접근을 기다림
    while (InterlockedExchange(&g_num, TRUE) == TRUE)
        Sleep(0);
    // 리소스에 접근..
    
    // 리소스에 더 이상 접근 필요 없음
    InterlockedExchange(&g_num, FALSE);        
    * InterlockedExchange 반환: TRUE인 경우 해당 리소스가 사용 중임을 나타낸다. 반대로 FALSE인 경우 해당 리소스는 사용 중이 아니다.
    </code></pre>
    * 스핀락을 사용하는 모든 스레드는 우선순위 레벨이 동일하고, 스레드 우선 순위 동적 상승 기능이 불가능하도록 설정되어야 한다.
    * 락 변수와 공유 리소스는 서로 다른 캐시 라인에 있도록 하는 것이 좋다. 만약 락 변수와 공유 리소스가 동일한 캐시 라인에 있다면, 리소스를 사용 중인 CPU는 동일 리소스에 접근하고자 하는 다른 CPU와 경쟁하게 될 것이다.
