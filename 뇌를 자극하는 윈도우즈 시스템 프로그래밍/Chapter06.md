# Chapter06 커널 오브젝트와 오브젝트 핸들
## Section01 커널 오브젝트에 대한 이해
### 커널 오브젝트의 이해
1. 커널 오브젝트: 커널에서 관리하는 중요한 정보를 담아둔 데이터 블록
2. CreateProcess 함수 호출 시 프로세스를 생성하는 주체는 사실 **OS**이다. 프로그래머가 함수를 호출하여 요청하는 것일뿐, 프로세스의 **생성과 관리**를 주체하는 것은 OS이다.
    1) 프로세스를 관리하기 위해서는 프로세스 상태 정보, 우선순위와 같은 정보를 관리해야 한다. 이러한 정보들의 데이터 구조체 덩어리를 **커널 오브젝트**라 한다. 이 커널 오브젝트는 OS 내부에 존재한다.
3. 커널 오브젝트는 프로그래머가 **직접 조작**할 수 없다.

### 그 이외의 커널 오브젝트들
1. 프로세스 이 외에도 쓰레드, IPC(Inter Process Communication), 파일 등의 리소스를 생성할 때에도 커널 오브젝트를 생성해서 필요한 정보들을 저장한다.
2. 생성되는 커널 오브젝트의 종류에 따라서 서로 다른 구조체를 기반으로 생성된다.

### 오브젝트 핸들(Handle)을 이용한 커널 오브젝트의 조작
1. 마이크로소프트에서 제공해주는 시스템 함수를 통해 프로그래머는 커널 오브젝트를 **간접적으로 조작** 할 수 있다.
2. 핸들 or 오브젝트 핸들: 커널 오브젝트 생성 시 프로그래머에게 부여되는 커널 오브젝트 할당 정수값 번호. 이 번호로 원하는 커널 오브젝트에 접근하여 간접적 조작을 할 수 있다.
    * 핸들-오브젝트-리소스의 관계
    <img width="500" src="https://user-images.githubusercontent.com/95362065/146154142-07d0d53d-c339-44f8-8b75-6766385032ec.png">
3. SetPriorityClass 함수
    1) BOOL SetPriorityClass(HANDLE, DWORD)
        * 프로세스의 우선순위를 변경시키는 함수

### CPU 점유권
1. 함수가 호출되는 중간에도 CPU의 점유권은 다른 프로세스에게 넘어갈 수 있다.

## Section02 커널 오브젝트와 핸들의 종속 
### 커널 오브젝트의 종속 관계
1. 커널 오브젝트는 Windows 운영체제(OS)에 종속적이다.
    * 본 책에서는 커널 오브젝트를 도서 대여점(OS)이 고객(프로세스)에게 빌려주는 책에 비유한다. 고객은 책을 "빌려" 볼 뿐이고 책은 도서 대여점에 "종속"적이다.
    * 위 관계에 더하여 커널 오브젝트의 소멸 시점은 운영체제에 의해 결정된다.
2. 커널 오브젝트가 OS에 종속적인 이유
    1) 커널 오브젝트의 소멸시점은 OS에 의해 결정된다.
    2) 하나의 커널 오브젝트는 하나의 프로세스가 아닌 여러 프로세스에 의해 접근될 수 있다. (예를 들어 프로세스 생성 시 프로세스 오브젝트에 부모와 자식 프로세스가 접근하고 있는 경우)

### 핸들의 종속 관계
1. 핸들은 OS가 아닌 **프로세스**에 종속적이다. 이에 대한 내용은 Chapter08에서 자세히 다룬다.

### 에제를 통한 종속 관계 이해 (예제1)
* 본 책의 예제를 일부 변경하여 커널 오브젝트 접근에 관한 내용을 설명하고자 하였다. (자료 경로: Chapter06_src/예제1)
* 본 예제를 통하여 커널 오브젝트가 프로세스가 아닌 OS에 종속적인 관계라는 것을 알 수 있다.

### PROCESS_INFORMATION 구조체
1. 구조체 구성
<pre><code>
typedef struct _PROCESS_INFORMATION {
  HANDLE hProcess;          // 프로세스 핸들(커널 오브젝트를 구분하기 위한 값)
  HANDLE hThread;           // 쓰레드 핸들
  DWORD  dwProcessId;       // 프로세스 ID (프로세스 자체를 구분하기 위한 값)
  DWORD  dwThreadId;        // 쓰레드 ID
} PROCESS_INFORMATION, *PPROCESS_INFORMATION, *LPPROCESS_INFORMATION;
</code></pre>
    * 출처: https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-process_information

## Section03 커널 오브젝트와 Usage Count
* 커널 오브젝트의 생성 주체는 프로세스가 아닌 "OS"이며 소멸주기 또한 생성의 주체인 "OS"가 결정한다.
### CloseHandle 함수에 대한 정확한 이해
