# 2022/05/16 수업내용(복습 완료)
## 학원 서버 셋팅
### 포트 포워딩
1. 포트 Mapping 
    1) 공인 IP(NAT 장비)의 포트 번호와 사설 IP의 포트 번호 매핑 시 서로 다른 포트 번호로 매핑
    2) 1과 같은 상황인데 같은 번호로 매핑 => 이렇게 매핑하는 것이 더욱더 관리하기가 편리하다. 안짝으로 들어가면 갈수록 관리가 힘들기 때문이다.
2. 네트워크 클래스의 구분
    1) 서브넷 마스크는 네트워크 클래스와 별개로 가져가도 된다.

### 랜카드
1. Realtek 랜카드의 허용 트래픽이 굉장히 적다. 일정 트래픽 이상 발생하면 연결이 끊기고 이후로 새로운 연결이 이루어지지 않는다.
    * Intel은 웬만해서 이런 문제가 발생하지 않는다.

### 시간 동기화
1. 시간이 동기화가 되지 않으면 로그, DB 저장 시에 자료 추적 등에서 문제가 발생할 수 있다.
    * 내부에 타임 동기화 서버를 두어 연결된 서버 간에 시간을 동기화한다.
    * 업데이트 서버의 경우에도 마찬가지이다. 업데이트 서버를 따로 두어 모든 서버가 해당 서버에 접속하여 업데이트를 진행
2. 윈도우에는 기본적으로 시간 동기화 서버 역할을 할 수 있는 기능이 있다. 특정 레지스트리를 수정하면 된다.

### 터미널 셋팅
1. 원격 데스크톱과 다른 원격 서비스와 다른 점
    1) 원격 데스크톱: 내부 메모리의 세션이 활성화된 것이다. 해당 세션의 화면은 원격 대상 컴퓨터의 내부 메모리에만 존재한다. 원격 접속 개수를 늘려 동시에 원격 접속을 할 수 있으며, 연결 하나하나 각자의 분리된 세션 작업 환경을 갖는다. 단, 같은 파일을 변경 등의 Disk 작업은 동기화가 이루어진다.
    2) 원격 서비스: 키보드나 마우스의 인풋을 제어하는 것이다. 따라서 원격 대상 컴퓨터의 화면이 꺼지면 접속을 했던 컴퓨터의 화면에서도 해당 화면이 꺼진다.
    * 예전에 SUN(오라클)에서 모든 직원 자리에 컴퓨터를 없애고 중앙에 센터를 두고 
2. Home 버전 윈도우즈는 원격 데스크톱 기능이 없다. Pro는 있음

### 윈도우 시리즈
1. 윈도우즈 서버 코어: 리눅스에 성능적으로 대적하기 위한 윈도우즈 서버, GUI가 없고 CUI 환경이다. PowerShell밖에 없다.
2. 윈도우즈 서버 나노: 서버 코어에서 더 들어가 핵심 커널 코드만 있는 제품 라인이다. 윈도우에서 필요로하는 서비스 웹 서버, DNS 서버 등을 사용하기 위한 목적으로 사용한다면 리눅스보다 훨씬 성능이 앞서게 된다.
3. 윈도우즈 데스크탑 에디션: 우리가 지금 사용하고 있는 윈도우 환경이다. 
    * 에디션 라인은 모두 같은 윈도우 10 코어를 사용하기 때문에 서버를 운용하기 위해서는 불필요한 서비스들을 사용 안함으로 해놓아야 한다. 대표적인 불필요한 서비스들은 테마, 폰트, 프린터, 생체인식 등이 있다.

### 윈도우 업데이트
1. 윈도우 자동 업데이트는 주기적인 검사하는 동작으로 인해 프로세서의 리소스를 은근 많이 잡아 먹는다. 또한, 간혹가다 재부팅되는 경우가 있다. 서버 계열은 재부팅을 하지 않는데 이러한 부분이 생긴다. 따라서 점검이 있을때마다 몰아서 업데이트를 해야 한다.
    * 현재는 완전 OFF 상태로 전환하는 것은 지원하지 않고 일시정지 기능을 제공한다. 한 번 일시정지하면 대략 40일 정도를 유지시켜주는데 이를 수시로 확인하여 갱신해주어야 한다.

### 종료
1. 윈도우즈 서버 재부팅: 서버계열의 컴퓨터는 거의 종료시키지 않는다. 따라서 재시작을 해야한다. 임시점검 시에도 종료가 아닌 재시작을 하게 된다.
    * Alt+F4를 눌러 종료하는 경우 사유를 명시해야 한다. 모두 기록이 된다.
    * 세션을 종료할 때는 Alt+F4 > 로그아웃으로 세션을 종료한다.

### 보안
1. 통신판매업으로 등록 시에 보안관리자를 지정하여 정부에 제출해야 한다. 한국인터넷진흥원에서 발생된 위험 사례 및 조치 방법들을 공지해준다. 이런 문제를 파악하여 바로바로 대처하면 해킹될 일은 없다.
2. 이벤트 뷰어 > Windows 로그 > 보안에서 감사 실패 로그를 확인하여 접속 시도 IP를 whois에서 확인하고 강사님께 말씀드려 수동으로 차단시키기
    * 이벤트 뷰어 로그 삭제는 건당건당 삭제되지 않는다. 전체 로그를 삭제하는 방법밖에는 없다.
    * 보안 정보에는 컴퓨터에서 발생하는 거의 모든 동작을 로깅하는데 이중에는 메모리 크래시에 대한 로그도 있다.
    * 만약 보안 탭에서 IP 확인이 되지 않으면 원격 데스크톱에서의 접속 시도로 판단하여 이벤트 뷰어 > 응용 프로그램 및 서비스 로그 > Microsoft > Windows > RemoteDesktopServices-RdpCoreTS > Operational 로 들어가 140번 이벤트 ID를 확인한다.
3. 회사에서는 보통 모든 접속 IP를 차단하고, 허용하고자하는 IP만을 등록하여 접속 허용하는 형태로 간다.
4. 해킹 유형
    1) 백도어: 컴퓨터에 뭔가가 설치가 되어 외부에서의 연결을 통과시켜주는 기법
    2) 컴퓨터에 프로그램이 깔려서 정보를 외부로 노출시키는 형태. 키로거같은 프로그램
5. 회사에서는 모든 IP를 차단하고 원하는 IP의 연결을 허용한다. 내부 인트라넷, 랜환경, 회사에서 사용하는 IP 등을 허용해서 사용하게 된다.
    * DB를 사용할 때는 외부 포트, 루프백으로 바인딩하지 않는다.

### 해킹
1. 나야나 랜섬웨어 사건
    1) '나야나'라는 웹 호스팅 업체에서 랜섬웨어에 감염되었다. 백업서버까지 감염이 되었다. 보통 백업을 3일 간격으로 한다.
        * 이 사건에서도 어떤 경로로 랜섬웨어에 감염이 되었는지 밝혀지지 않았다.
    2) 이 사건 이후로 호스팅 서비스 보안 및 백업 권고 가이드라인이 생겨났다.
2. 큰 회사들은 OTP 솔루션을 서버에 설치하여 원격 데스크탑 접속 시에도 OTP 비번을 입력하여야 한다.
    * 그래서 서버 관계자들이 OTP 목걸이를 다 차고 다님
4. 호스팅 서비스 보안 및 백업 권고 가이드라인
    1) 패스워드 정책: 패스워드를 종이 문서로 관리하자라고 가이드라인에서 권고한다.
    2) VLAN: L2 스위치에서 포트 별로 구역을 나누어 따로따로 LAN 환경을 구성할 수 있다.(즉 하나의 L2 스위치에서 망 분리)
    3) 백업1: 웹 호스팅 서버는 active-standby 형태로 서비스 되어야 한다. 백업을 단기와 장기 백업을 유지하고, 백업 서버는 별도의 스토리지에서 운영하도록 구성한다.
        * 같은 서버에서의 백업 본은 백업으로 쳐주지 않는다! 라는 말이다. 별도의 백업 서버를 두어야 한다.
    4) 백업2: 데이터 서버->백업 서버로의 백업 방향이 아닌, 백업 서버->데이터 서버에 접근하여 백업 데이터를 가져가 백업을 해야 한다.
5. 서버 개발자는 PC방, 도서관 등의 공공 장소에서 개인 메일, 회사 메일 등 절대 접속하지 않는다. 이런 장소들은 바이러스에 감염되었다고 보자는 것이다.
    * 공용 와이파이 또한 접속하지 않는다. 와이파이 자체가 캡쳐될 수가 있기 때문이다.
    * 만약 불가피하게 공공 장소에서 이메일을 사용해야 하는 경우, 메모장같은 곳에 비밀 번호에 아무런 문자를 섞어서 적어놓고 부분 부분 복사해서 비밀번호를 입력한다.
6. 스마일 서브, 네이버, 구글 등 클라우드 서비스를 하는 곳은 3중 백업을 한다. 파일 시스템 자체를 개발하여 하나의 백업 본을 세개의 시스템에 저장한다.
    * 이 시스템의 핵심은 3개의 백업본이 있으면 3개 모두 감염될 확률이 0퍼센트라는 것이다. 또한 이 3개의 백업본을 관리하는 관리 서버가 하나 별도로 존재한다.
    * 역설적이게도 얼마 전 스마일 서브에서 백업본을 관리하는 관리 서버가 깨져서 모든 데이터가 유실되었다.

### 원격 디버깅
1. 첫 번쨰: 작업 관리자 -> 세부 정보(프로세스 찾기) -> 문제 소지가 있을 코드 쪽에 Block -> Dump파일 만든 후 열기 -> VS로 Dump를 열어 확인해보기
    * 똑같은 코드, 똑같은 실행파일, 해당 pdb 파일 까지 있다면 디버깅 파일이 열릴 것이다.
2. 두 번째: VS 설치된 폴더 이동 -> 2019 -> Community -> Common7 -> IDE -> Remote Debugger -> x86 혹은 x64 를 원격 데스크톱으로 붙여넣기 -> msvsmon.exe 실행 -> 포트 번호(접속 시도 PC) -> 인증 안 함(인증을 하려면 윈도우 계정이 맞춰줘야하는데 번잡스러움) -> VS -> 프로세스에 연결 -> 연결 형태는 원격, 연결 대상을 proca...:port로 찾기 -> 종료 절차, 디버그 > 분리
    * 기본 포트 상태로 찾기를 하게 되면 LAN에서 원격 디버깅 포트를 훑어 아무나 들어갈 수 있게 된다. 이렇게 되면 LAN 환경의 아무 유저가 해당 프로세스에 접속하여 메모리를 엎어버릴 수가 있게 된다.

## 기타 키워드
### DDNS(Dynamic-DNS)
1. 보통 DNS라 하면 고정 IP에 대한 도메인을 관리하는 시스템이고, DDNS는 동적 IP를 도메인으로 매핑시켜주는 DNS이다.
2. DNS와 DDNS의 차이점: 매핑 갱신 주기이다. DNS 서버는 TTL이 기본 24시간으로 설정하여 도메인을 갱신한다. DDNS는 이 주기가 초, 분단위이다.
3. 예전에는 유료 서비스였는데 지금은 공유기에서 무료로 이 기능을 제공한다.
4. 집에서 DDNS 세팅 해보기!!

### 네트워크 클래스
1. 각 클래스별 사설 IP 대역과 서브넷 마스크
    1) A: 10.0.0.0 ~ 10.255.255.255 / 255.0.0.0
    2) B: 172.16.0.0 ~ 172.31.255.255 / 255.255.0.0
    3) C: 192.168.0.0 ~ 192.168.255.255 / 255.255.255.0
