# 2022/07/22 수업내용
# 네트워크 라이브러리
## 메모리풀
### Heap
1. Heap은 특정 사이즈 별로 규격을 나눠서 메모리를 관리한다. (LFH를 생각하면 쉬움)
2. 우리의 풀과 Heap의 차이점은 가비지 컬랙터의 유무 뿐이다.

### 안정장치와 부가 기능
1. 안정 장치 코드와 부가 기능은 성능 측정할 때 define으로 막아놓아야 한다.
    1) 이건 사기가 아니다. 이건 말 그대로 부가적이고 안전한 장치를 추가한 것이지 
    2) 안정 장치: overflow, underflow
    3) 부가 기능: palcement new 등..

### TLS를 사용할 때의 단점
1. 스레드마다 사용되지 않는 메모리가 많아진다. 이건 확실히 단점이 된다. 이곳 저곳에서 만들어지면 이것도 크기가 꽤 크다.

## TLS
### 사용
1. 사용처
    1) 메모리풀
    2) 프로파일러
2. TLS의 활용: 스레드의 구분된 작동을 해야하는 경우 활용할 수 있다.
3. TLS, 스레드 ID를 쓰지않고 스레드를 구분할 수 있는 방법이 있는가?
    1) 해당 스레드의 스택을 이용해서 구현한다는 의견이 있다. Main 스레드의 지역변수로 선언을 해놓고 함수를 호출할 때마다 매개변수로 
        * 이런 언급을 했다는 것은 TLS를 잘 사용해보지 않은 사람이다.

## 프로파일러
### 프로파일러
1. 프로파일링 구조체 주소를 TLS에 저장하여 사용할 것이다.
    1) 단점: 다른 스레드의 TLS에는 접근할 수 없으니 마지막에 저장할 때 문제가 된다.
        * 이와 같은 단점에 따라 모든 스레드의 프로파일링 구조체를 관리하는 하나의 
2. 프로파일링 구조체 관리 
    1) 각 스레드의 필요없다.
    2) 컨테이너
        * List: Push할 때 동기화가 필요하다. 동기화 객체를 사용하여 도익화
        * Array: Push할 때 Interlocked을 통해 Index를 부여해야 한다.
        * 그러나 둘의 동기화 방
3. 프로파일링 구조
    1) 구조
        <pre><code>
        Thread Sample
        {
            ProfileSample[50];
            ThreadID;
        }
        ProfileSample
        {
            Tag,
            TotalTime,
            TotalCall,
            Max,Min
        }
        </code></pre>
4. 캐시 미스의 요인
    1) 컨텍스트 스위칭(다른 프로세스)
    2) 만약 다른 프로세스가 없는 상황이다. 같은 스레드가 다른 코어에 
5. 하이퍼 스레딩 구조라면 선호도를 어떻게 배치할 것인가?
    1) 각기 다른 코어(논리 코어x)에 배정한다. CPU 내부에는 각기 다른 연산을 하는 연산기들이 존재한다. 만약 같은 코어에 배정하게 되면 같은 연산을 하게되는 경우가 많을 수 있다.
    2) 각기 다른 코어(논리 코어x)에 배정한다. 같은 프로세스의 스레드들이 같은 코어(논리 코어는 다른)에서 돌게되면 캐시 히트율에 문제(?? 의문이 듦)
    3) 또 다른 방법: BIOS에서 하이퍼 스레딩 기능을 꺼버린다.

### 출력
1. 스레드를 모두 통합하게 된다면 통합하는 순간에 오차가 생길 수 있다.

## 직렬화 버퍼
### 사용
1. SendPacket은 엄밀히 따지자면 외부로부터 호출되는 함수이다. 이에 따른 문제점과 해결 방법은 다음과 같다.
    1) 문제: 
    2) 해결: 생성자를 private 지정자로 지정하여 생성 자체를 막아버린다. 이후 어떻게 생성하여 사용할 지는 고민해보기 (Singleton??)

### 참조 카운트
1. 참조 카운트를 어떻게 넣을 것인지 고민
