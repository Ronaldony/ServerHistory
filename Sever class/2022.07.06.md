# 2022/07/06 수업내용
# 락프리 큐
## 디버깅
### 문제
1. 문제1: DeQ로 같은 값을 반환하였을 때
    1) 방법: DeQ 작업을 하기 전에 Data를 저장하는 . 하지만 이 대상이 객체라면 성능이 굉장히 떨어질 것이다.
2. 문제2: EnQ 내부에서 tail->next는 교체하였는데 tail을 교체하지 못한 상황에서 다음 번 EnQ 무한루프가 돌게되는 상황
    1) 상황1: tail을 교체하는 것에 실패한 스레드의 다음 동작이 EnQ인 경우, 해당 스레드와 다른 EnQ 스레들이 무한루프를 돌게 된다.
    2) 상황2: tail을 교체하는 것에 실패한 스레드의 다음 동작이 DeQ인 경우, 해당 스레드가 DeQ 작업을 하고 다시 EnQ 작업에 들어갔을 때 Head와 Tail이 역전된다.
    3) 문제 원인과 해결: 특정 스레드가 tail을 교체하는데 실패하였을 때 다른 스레드가 tail을 교체하고 제 할 일을 하게 해야 한다. 그러나 역설적이게도 다른 스레드가 tail을 교체하는 작업으로 인해서 또 다른 문제2가 발생한다.
3. 문제3: EnQ에 실패하는 경우가 없다. DeQ는 실패하는 경우가 있다. 
    1) DeQ를 할 때 Size를 감소시키고 DeQ 작업을 진행한다. size가 0보다 크거나 같은 경우에 DeQ 작업에 들어간다.
        * 이 작업을 적용시켜도 발생하는 문제가 하나 있다. size를 확인하고 DeQ 작업 내부에서 head->next가 Null 인 상황이 벌어진다. 이 상황은 사실 문제2와 관련된 문제이다.

## 락프리 큐
### 동작
1. 락프리에서는 EnQ, DeQ에 실패하는 경우가 없어야 한다.
2. 스핀락은 애초에 멈추기 때문에 상대방의 로직도 기다려주는 상황이 된다. 하지만 락프리는 상대방의 로직을 기다려주지 않는다. 즉 락프리보다 더 급한 성격이다.

### 테스트
1. 동기화 객체와 스핀락, 락프리의 비교
    1) 만약 컨텍스트 스위칭 등 외부적인 비용을 모두 제외한다면 모두 동일한 시간 내에 동일한 횟수가 이루어져야 한다.
2. 테스트의 기준
    1) 정해진 시간 내 EnQ, DeQ 횟수: 이 건에 대해서는 정확한 판단이 이루어질 수 없다. 그 이유는 앞서 말한 동기화, 스핀락, 락프리의 비교에서
    2) 테스트의 기준을 정할 때 락프리의 목적을 기준으로 생각해보아야 한다. 가장 먼저 성공한 놈이 작업에 성공한다.

## 포트폴리오
### 작성
1. 총 10 페이지 정도로 작성될 것이다.
2. 락프리 큐의 경우에는 EnQ의 CAS 실패 건에 대해서 작성할 것이다.
