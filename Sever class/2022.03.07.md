# 2022/03/07 수업내용(복습 완료)
## 그림 그리기 과제
### WSAAsyncSelect
1. send
    1) sendpacket의 보내기 조건: sendQ가 비워지거나 WOULDBLOCK이 발생할 때 까지
    2) 전송할 데이터가 있을때마다 보내는 방식: 보낼 데이터가 많아지면 안 좋은 형태가 될 수 있다.
2. 프로그램 구조
    <pre><code>
    WM_MOUSEMOVE:
        현좌표
        이전좌표
        stHEADER header
        st_DRAW_PACKET draw
        
        // 헤더, 데이터 패킷 초기화
        sendpacket(...);
    FD_READ:
        char Buffer[...]];
        recv(...)
        
        RecvQ.Enqueue...
        
        stHeader header;
        while(1)
        {
            if(RecvQ.getusesize() > 헤더사이즈)
            
            RecvQ.Peek(&header);
            
            if(header.len + sizeof(stHeader) <= recvQ.getusesize())
            
            완성된 메시지를 뽑아서
            PacketProc(...);
            // 실제 코드의 경우 참을 찾는 경우가 들어가면 코드가 굉장히 더러워진다. 따라서 보통 거짓을 찾아 break;를 하는 형태로 코드가 짜여진다.
        }
    PacketProc(...)
    {
        x,y,x,y DC에 그리기
    }
    </code></pre>

## TCP 파이터 과제
### 이동
1. 해당 과제에서는 방향이 8개로 정해져 있기 때문에 유저가 같은 이동 방향으로 움직일 때는 서버에 패킷을 날리지 않는다. 액션이 달라지는 경우에만 패킷을 날린다.
    * 요즘 게임은 방향이 정해져있지 않기 때문에 해당 과제처럼 게임을 만들지는 않는다. 따라서 실제 게임에서는 방향 정보로만 데드레커닝 할 수 없다.
2. 속도: 프레임 단위로 이동 처리를 하였기 때문에 FPS가 틀어지면 클라끼리 이동 속도가 달라질 수 있다.
3. 이동 처리는 프레임 단위와 시간 단위로 나뉠 수 있다.

### 목적지의 공유
1. 문제: 데드레커닝을 하는 경우 도착지점이 불분명한 조작 방법(키보드, 손가락 등)으로 인해 내 클라와 다른 클라의 도착지가 다른 경우
    1) 동기화 방법1: 캐릭터가 특정 방향으로 움직이다가 멈추었을 때 해당 클라이언트의 캐릭터를 같은 방향으로 약간 더 움직이게 하는 방법. 
    2) 동기화 방법2: 일정 구간마다 데드레커닝으로 임시 목적지를 만들고 구간마다 좌표를 동기화하는 방법
    * 대개 데드레커닝으로 캐릭터의 좌표를 계산하는 경우 서버와 다른 클라이언트의 좌표는 해당 클라이언트의 좌표보다 더 움직이게 된다.
    * 이 방법들은 예시일뿐이지 실제 게임에서는 조작 방식, 2D-3D의 여부 등에 따라 목적지 동기화 방법이 다 달라진다.

### 데이터 패킷
1. P2P에 클라이언트가 주체이기 때문에 
2. 서버 좌표의 

### 공격
1. 정석적으로는 특정 공격 이후에 공격이 가능한 시간을 검사하여 클라의 공격 메시지를 처리하여야 한다.
2. 타격 시점과 이펙트 발생 시점을 동기화를 시켜야 한다.(클라이언트의 몫이다.)
    1) 공격 메시지 수신 시점에 이펙트를 생성해서 프레임 시작 지점을 결정하는 방법
    2) 타격 시점에 이펙트를 생성하는 방법

### 내 플레이어
1. 공격이 끝나야 이동이 가능한 조작 방식
    1) 다른 클라이언트 행동 변화는 서버가 시키는대로 동작되어야 한다. 그렇지 않으면 다른 플레이어의 행동이 끝나야만 다른 동작을 처리하게 될텐데 이때 행동이 안 끝난 상태에서 메시지가 수신되면 이것에 대한 처리가 되지 않는다.(씹힌다)

## 기타 키워드
### 디버깅
1. 로그를 보고 문제를 파악하는 능력을 길러야 한다. (로그, 메모리 뷰 등)

### 데드레커닝
1. 연결되어 있는 모든 클라와 서버가 
