# Chapter13 윈도우 메모리의 구조
## Section01 프로세스의 가상 주소 공간
### 가상 주소
1. 애플리케이션에서 접근 예외를 유발하지 않고 성공적으로 데이터에 접근하기 위해서는 접근하고자 하는 주소 공간에 물리적 저장소가 할당되거나 매핑되어 있어야만 한다.

## Section02 가상 주소 공간의 분할
### 가상 주소 공간
1. 각 프로세스의 가상 주소 공간은 분할되어 있으며, 각각의 분할 공간을 파티션이라고 한다.
2. 프로세스 주소 공간의 분할
    |파티션|x86 32비트 윈도우|x86 64비트 윈도우|
    |------|---|---|
    |NULL 포인터 할당|0x0 ~ 0xFFFF|0x0 ~ 0xFFFF|
    |유저 모드|0x10000 ~ 0x7FFEFFFF(2GB)|0x10000 ~ 0x7FF FFFEFFFF(8192GB)|
    |64KB 접근 금지|0x7FFF0000 ~ 0x7FFFFFFF|0x7FF FFFF0000 ~ 0x7FF FFFFFFFF|
    |커널 모드|0x80000000 ~ 0xFFFFFFFF|0x800 00000000 ~ 0xFFFFFFFF FFFFFFFF|
    1) NULL 포인터 할당 파티션: 프로그래머가 NULL 포인터 할당 연산을 수행할 경우를 대비하기 위해 준비된 영역이다. 이 파티션에 대해 읽거나 쓰기를 시도하게 되면 접근위반이 발생하며, 프로세스는 종료된다.
    2) 유저 모드 파티션: 프로그래머가 접근 가능한 주소 영역이다. 이 주소 공간에는 힙, 스택, 코드, 데이터 영역의 데이터가 저장된다. DLL과 메모리 맵 파일이 이 파티션에 로드된다. 
    3) 커널 모드 파티션: 운영체제를 구성하는 코드들이 위치한다. 스레드 스케줄링, 메모리 관리, 파일시스템 지원, 네트워크 지원 등을 구현하는 코드와 모든 디바이스 드라이버들이 이 파티션에 로드된다.

## Section03 주소 공간 내의 영역
### 주소 공간 예약
1. 주소 공간을 Reserve 시 **시작 주소**는 할당 단위 경계 상에 위치해야 한다. (본 책에서는 당시 할당 단위는 64KB이어서 시작 주소를 64KB로 나누어 떨어지는 위치로 지정해야 한다고 언급)
2. 주소 공간을 Reserve 시 **예약할 크기**는 반드시 시스템의 **페이지 크기**의 배수로 설정해야 한다.
    * 페이지란 운영체제가 메모리를 관리할 때 사용하는 최소 단위를 말한다.

## section05 물리적 저장소와 페이징 파일
### 페이징 파일
1. OS는 디스크 공간을 메모리처럼 활용할 수 있는 기능을 지원하는데, 디스크 상에 존재하는 이러한 파일을 Paging file 이라고 한다.
2. 시스템의 페이징 파일의 크기는 애플리케이션에서 사용할 수 있는 물리적 저장소의 크기를 결정하는 가장 중요한 요소가 되며, 실제 램의 크기는 크게 영향을 주지 못한다.

### 가상 주소->물리적 주소 변경
1. 다이어그램
    * <img width=600 src="https://user-images.githubusercontent.com/95362065/157368324-0a9fc2ea-4bfd-46db-8806-0f40bb73ded3.png">
2. 데이터를 램->페이징 파일 혹은 페이징 파일->램으로 가져오는 작업이 많아지면 많아질수록 발생하는 디스크 트레쉬(Disk thrash)가 생기고 이는 시스템의 수행 속도를 점점 더 느려지게 한다.
    * 트레슁: OS가 프로그램을 수행하지 못하고 대부분의 시간을 페이지 파일과 램 사이의 스와핑에 소비하는 현상
    * 컴퓨터에 추가적으로 램을 설치하면 트레슁의 정도가 감소하여 시스템의 성능이 개선된다. 실제로도 대부분의 상황에서 CPU를 교체하는 것보다 추가적으로 램을 설치하는 것이 좀 더 큰 성능 개선을 가져온다.

### 페이지 파일 내에 유지되지 않는 물리적 저장소
1. 어플리케이션을 수행하면 시스템은 .exe 파일을 열어 코드와 데이터의 크기를 얻어낸다. 이후 가상 주소 공간에 얻어낸 크기만큼의 영역을 예약하고, 이 영역에 대한 커밋된 물리적 저장소를 .exe 파일 자체라고 설정한다. 시스템은 페이징 파일에 공간을 할당하는 대신 가상 주소 공간에 예약된 영역을 이처럼 활용함으로써 좀 더 빠르게 어플리케이션을 로딩할 수 있다.

## Section06 보호 특성
