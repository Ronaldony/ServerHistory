# 2022/06/29 수업내용
# 락프리
## 락프리 메모리풀
### 디버깅
1. 락프리 메모리풀 디버깅 시 어려운 점은 명확히 문제가 되는 지점에서 크래쉬가 나거나 멈추는 행위가 되지 않기 때문이다.

### 테스트
1. 메모리풀을 적용시키지 위하여 우선 메모리풀 자체에 대한 테스트가 되어야 한다.
2. 메모리풀 자체의 테스트
    1) Alloc: 같은 주소를 할당시켜주는 경우
        * 첫 번째 방법: Alloc한 주소를 모두 기록하여 순회하며 일일히 확인한다.
        * 두 번째 방법: IOCount와 같은 변수를 노드에 두어 Alloc할 때 증가시키고 Free할 때 감소시켜서 해당 값을 확인하여 문제 상황을 잡아내는 방식
    2) Free: Stack 자체에서 Free를 잘못한 경우
        * Free를 요청하였는데 Stack이 정상적으로 . 막연하게 개수가 틀어졌다 밖에 보지 못한다.
3. 테스트
    1) 규칙을 만들어야 한다. Push하는 개수, 해제하는 개수를 명확히 정하고 테스트해야 한다.
        * 예를 들어 처음 Alloc을 하여 10만개까지 확보를 해놓고, 10개의 스레드에서 1만개씩 Alloc 후 Free를 하는 방식으로 테스트한다. 중간중간 Data와 Count를 확인한다.
        * Data와 Count를 기준으로 테스트하는 방식을 선택하였다. Alloc 시 Data를 특정 값을 저장하고 Count를 0으로 초기화한다. Fee
        * Alloc과 Free를 
    3) 실패에 대한 규칙(Crash)
        * 개수를 정해놓고 했다라면
        * 1: Alloc 후 초기 Data, Count에 대한 검사
        * 2: Data와 Count에 대한
    4) 스레드 개수
        * Push와 Pop의 스레드 개수에 대한 논의는 코어를 고려하여 생각해보는 것이 좋다.
        * 멀티 스레드 환경에서는 다양한 방향의 수행이 이루어져야 한다.
4. 서버의 문제
    1) 상황: 
    2) 첫 번째 방법: 디버깅 스레드 창에서 스레드를 중지하고 재개하여 제어 방식으로 
    3) 두 번째 방법: Sleep(0)을 이용하여 퀀텀 타임을 포기하게 만들어 
    4) 세 번째 방법: 조사식이나 메모리에 직접적으로 임의로 변수를 문제의 상황으로 만들어  
    5) 두 번째 방법:

## 기타 키워드
### 디버깅
1. 문제: Disconnection 테스트 시 Send Error가 나는데 
    1) WSASend 지점에서 내가 무슨 데이터를 보내는 지 확인하는 방법이 있다.

### 기타
1. Sleep(0)고 SwitchToThread()
    1) Sleep(0)의 목적은 지금 내 퀀텀 타임을 포기하는데에 목적이 있다. 그래서 MSDN에는 프로세서에 대한 언급은 특별히 되지 않는다.
    2) SwitchToThread의 목적은 그래서 MSDN에는 다른 프로세서에서도 해당 스레드가 실행되지 않는다는 언급을 한다.
    3) 우선 순위에 대한 
2. AMD 코어
    1) AMD에서는 락프리 문제가 나지 않는다. Why?
