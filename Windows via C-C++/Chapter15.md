# Chapter15 애플리케이션에서 가상 메모리 사용 방법
## 들어가기에 앞서
1. 마이크로 소프트 윈도우는 메모리를 사용하는 세 가지 서로 다른 방법을 제공한다.
    1) 가상 메모리, 이 방법은 크기가 큰 객체나 구조체의 배열을 관리하는 데 최적의 방법이다.
    2) 힙, 이 방법 크기가 작지만 개수가 많은 객체를 관리하는 데 최적의 방법이다.
    3) 메모리 맵 파일, 이 방법은 크기가 큰 데이터(일반적으로 파일에 저장되어 있는) 스트림을 관리하거나 단일 머신에서 수행 중인 다수의 프로세스 사이에서 데이터를 공유하고자 할 때 최적의 방법이다.

## Section01 주소 공간 내에 영역 예약하기
### VirtualAlloc 함수
1. 기능: 가상 주소 공간 내에 영역을 예약할 수 있다.
2. 함수의 구조
    <pre><code>
    LPVOID VirtualAlloc(
        LPVOID lpAddress,
        SIZE_T dwSize,
        DWORD  flAllocationType,
        DWORD  flProtect
    );
    </code></pre>
    1) lpAddress: 입력된 주소 값으로 시작되는 공간 할당을 요청하게 된다. 보통 NULL을 입력하는데, 이렇게 하면 시스템이 관리하고 있는 프리 주소 영역 중 가장 적절한 공간을 찾아낸다.
        * 무조건 유저 모드 파티션을 가리키는 값을 전달해야 한다. 아니라면 함수 호출을 실패하여 NULL을 반환한다.
        * NULL이 아닌 값을 입력 시 함수 내에서 할당 단위 경계 64KB를 경계로 하여 주소를 할당하게 된다.
    2) dwSize: lpAddress를 시작 주소로 하는 할당 요청 크기
        * 함수 내부에서 페이지 크기(4KB)로 나누어지는 크기로 변환되어 할당한다.
    3) flAllocationType: 예약 또는 커밋인지에 대한 여부 
        * 또 다른 기능: MEM_TOP_DOWN을 입력하여 가용 주소 영역 중 가장 높은 주소 공간 상에 영역을 예약할 수 있다.(단, 동시에 lpAddress에 NULL을 입력해야 함) 이렇게 함으로써 중간 위치에 예약될 시 발생하는 메모리 단편화 현상을 피할 수 있다.
    4) flProtect: 영역에 대한 보호 특성을 지정한다. 보통 PAGE_READWRITE를 사용한다.

## Section04 언제 물리적 저장소를 커밋하는가
